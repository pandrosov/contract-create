# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt

## –î–∞—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: 2025-11-05

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### 1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω certbot nginx plugin
- –ü–∞–∫–µ—Ç: `python3-certbot-nginx`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ nginx

### 2. –°–æ–∑–¥–∞–Ω–∞ webroot –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- –ü—É—Ç—å: `/var/www/certbot`
- –ü—Ä–∞–≤–∞: `755`
- –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx –∫–∞–∫ read-only

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
- –î–æ–±–∞–≤–ª–µ–Ω location –¥–ª—è `.well-known/acme-challenge/`
- –ü–æ–∑–≤–æ–ª—è–µ—Ç Let's Encrypt –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ HTTP challenge

### 4. –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.prod.yaml
- –î–æ–±–∞–≤–ª–µ–Ω volume –¥–ª—è `/var/www/certbot`
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ webroot –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### 5. –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –§–∞–π–ª: `scripts/update_ssl_certificates.sh`
- –§—É–Ω–∫—Ü–∏–∏:
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
  - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ certbot
  - –ö–æ–ø–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx
  - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç nginx –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### 6. –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –§–∞–π–ª: `scripts/check_ssl_expiry.sh`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, –µ—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç –º–µ–Ω–µ–µ —á–µ–º —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

### 7. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ cron –∑–∞–¥–∞—á–∞
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 –Ω–æ—á–∏
- –ö–æ–º–∞–Ω–¥–∞: `/opt/contract-app/scripts/update_ssl_certificates.sh`
- –õ–æ–≥–∏: `/var/log/ssl-renewal.log`

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** (3:00 –Ω–æ—á–∏):
   - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
   - –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç –º–µ–Ω–µ–µ —á–µ–º —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - Certbot –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ webroot –º–µ—Ç–æ–¥

2. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**:
   - –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç –∫–æ–ø–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx**:
   - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç nginx –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üîß –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤—Ä—É—á–Ω—É—é:

```bash
cd /opt/contract-app
./scripts/update_ssl_certificates.sh
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

```bash
cd /opt/contract-app
./scripts/check_ssl_expiry.sh
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
tail -f /var/log/ssl-renewal.log
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞—á–∏:

```bash
crontab -l | grep ssl
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç**: 18 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞
   - –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç

2. **Webroot –º–µ—Ç–æ–¥**: –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ `/.well-known/acme-challenge/` —á–µ—Ä–µ–∑ HTTP
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ

3. **–õ–∏–º–∏—Ç—ã Let's Encrypt**: 
   - –ù–µ –±–æ–ª–µ–µ 5 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –Ω–µ–¥–µ–ª—é –Ω–∞ –¥–æ–º–µ–Ω
   - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –†–∞–∑ –≤ –º–µ—Å—è—Ü –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

